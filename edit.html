<!doctype html>
<html lang="cs">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Upravit rezervaci - Chata Mari√°nsk√°</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="/favicon.ico"
    />
    <link
      rel="stylesheet"
      href="css/styles-unified.css"
    />
  </head>
  <body style="margin: 0; padding: 0; width: 100%; max-width: 100%; overflow-x: hidden">
    <div style="width: 100%; max-width: 100%; padding: 1rem 1rem; box-sizing: border-box">
      <div
        class="header"
        style="max-width: none"
      >
        <h1>üìù Upravit rezervaci</h1>
        <p style="color: var(--gray-600)">Chata Mari√°nsk√°</p>
      </div>

      <!-- Loading State -->
      <div
        id="loadingState"
        style="text-align: center; padding: 3rem"
      >
        <div class="spinner"></div>
        <p>Naƒç√≠t√°n√≠ rezervace...</p>
      </div>

      <!-- Error State -->
      <div
        id="errorState"
        style="display: none"
      >
        <div
          style="
            background: #fee2e2;
            border: 2px solid #ef4444;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
          "
        >
          <h2 style="color: #dc2626; margin-bottom: 1rem">‚ö†Ô∏è Chyba</h2>
          <p
            id="errorMessage"
            style="color: #991b1b; font-size: 1.1rem"
          ></p>
          <a
            href="/"
            class="btn btn-primary"
            style="margin-top: 1rem; display: inline-block"
          >
            Zpƒõt na hlavn√≠ str√°nku
          </a>
        </div>
      </div>

      <!-- Edit Deadline Warning -->
      <div
        id="editDeadlineWarning"
        style="display: none"
      >
        <div
          style="
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            border: 3px solid #ef4444;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            animation: pulse 2s infinite;
          "
        >
          <h3 style="color: #dc2626; margin-bottom: 1rem">
            <span style="font-size: 2rem">üîí</span>
            <span>Rezervace je uzamƒçena</span>
          </h3>
          <p id="deadlineMessage">
            √öpravy a zru≈°en√≠ rezervace jsou mo≈æn√© pouze <strong>3 dny p≈ôed zaƒç√°tkem pobytu</strong>.
          </p>
          <p>
            üí° Pro zmƒõny kontaktujte administr√°tora:
            <strong><span id="contactEmailDisplay">chata@utia.cas.cz</span></strong>
          </p>
        </div>
      </div>

      <!-- Edit Form Container -->
      <div
        id="editFormContainer"
        style="display: none"
      >
        <div
          class="modal-content"
          style="
            width: 100%;
            max-width: 100%;
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
          "
        >
          <h2
            id="editModalTitle"
            style="margin-bottom: 2rem"
          >
            Upravit rezervaci <span id="bookingIdDisplay"></span>
          </h2>

          <!-- Tab navigation -->
          <div
            class="edit-tabs"
            style="
              display: flex;
              gap: 1rem;
              margin-bottom: 1.5rem;
              border-bottom: 2px solid #e5e7eb;
            "
          >
            <button
              class="edit-tab-btn active"
              data-tab="dates"
              onclick="editPage.editComponent.switchTab('dates')"
              style="
                padding: 0.75rem 1.5rem;
                background: none;
                border: none;
                border-bottom: 3px solid #0d9488;
                color: #0d9488;
                font-weight: 600;
                cursor: pointer;
              "
            >
              üìÖ Term√≠n a pokoje
            </button>
            <button
              class="edit-tab-btn"
              data-tab="billing"
              onclick="editPage.editComponent.switchTab('billing')"
              style="
                padding: 0.75rem 1.5rem;
                background: none;
                border: none;
                border-bottom: 3px solid transparent;
                color: #6b7280;
                font-weight: 600;
                cursor: pointer;
              "
            >
              üìã Fakturaƒçn√≠ √∫daje
            </button>
          </div>

          <form id="editBookingForm">
            <input
              type="hidden"
              id="editBookingId"
            />

            <!-- Dates and Rooms Tab -->
            <div
              id="editDatesTab"
              class="edit-tab-content"
            >
              <div
                style="
                  margin-bottom: 1rem;
                  padding: 1rem;
                  background: #e0f2fe;
                  border-radius: 8px;
                  border-left: 4px solid #0284c7;
                "
              >
                <p style="margin: 0; font-size: 0.9rem; color: #075985">
                  ‚ÑπÔ∏è <strong>Kliknƒõte na "Zmƒõnit term√≠n"</strong> u pokoje, kter√Ω chcete upravit.
                  Kalend√°≈ô zobraz√≠ p≈Øvodn√≠ term√≠n <strong style="color: #3b82f6">mod≈ôe</strong>.
                </p>
              </div>

              <!-- Two column layout: Calendar left, Rooms right -->
              <div style="display: grid; grid-template-columns: 1fr 450px; gap: 2rem">
                <div>
                  <div
                    id="editCalendarHeader"
                    style="display: none; margin-bottom: 1rem"
                  >
                    <h3 style="margin: 0 0 0.5rem 0">
                      Kalend√°≈ô - <span id="editingRoomName"></span>
                    </h3>
                    <button
                      type="button"
                      id="cancelRoomEditBtn"
                      class="btn btn-secondary"
                      style="padding: 0.5rem 1rem"
                    >
                      ‚úï Zav≈ô√≠t kalend√°≈ô
                    </button>
                  </div>
                  <div
                    id="editCalendarContainer"
                    style="display: none"
                  ></div>
                  <div
                    id="editSelectedDatesContainer"
                    style="
                      display: none;
                      margin-top: 1rem;
                      padding: 1rem;
                      background: #fef3c7;
                      border-radius: 8px;
                    "
                  >
                    <strong>Novƒõ vybran√Ω term√≠n:</strong>
                    <div
                      id="editSelectedDates"
                      style="margin-top: 0.5rem; color: #d97706; font-weight: 600"
                    >
                      Zat√≠m nevybr√°no
                    </div>
                  </div>
                  <button
                    type="button"
                    id="saveRoomDatesBtn"
                    class="btn btn-primary"
                    style="
                      display: none;
                      margin-top: 1rem;
                      padding: 0.75rem 1.5rem;
                      width: 100%;
                      font-size: 1.1rem;
                    "
                  >
                    ‚úì Ulo≈æit term√≠n
                  </button>
                </div>

                <div>
                  <h3>V≈°echny pokoje</h3>
                  <div
                    id="editRoomsList"
                    style="display: flex; flex-direction: column; gap: 0.5rem"
                  >
                    <!-- Rooms will be populated here -->
                  </div>

                  <div
                    style="
                      margin-top: 1.5rem;
                      padding: 1rem;
                      background: #fef3c7;
                      border-radius: 8px;
                    "
                  >
                    <strong>Celkov√° cena:</strong>
                    <div
                      id="editTotalPrice"
                      style="font-size: 1.5rem; color: #d97706"
                    >
                      0 Kƒç
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Billing Information Tab -->
            <div
              id="editBillingTab"
              class="edit-tab-content"
              style="display: none"
            >
              <div class="form-grid">
                <div class="input-group">
                  <label for="editName">Jm√©no a p≈ô√≠jmen√≠ *</label>
                  <input
                    type="text"
                    id="editName"
                    required
                  />
                </div>
                <div class="input-group">
                  <label for="editEmail">Email *</label>
                  <input
                    type="email"
                    id="editEmail"
                    required
                  />
                </div>
                <div class="input-group">
                  <label for="editPhone">Telefon *</label>
                  <input
                    type="tel"
                    id="editPhone"
                    required
                  />
                </div>
                <div class="input-group">
                  <label for="editCompany">Firma</label>
                  <input
                    type="text"
                    id="editCompany"
                  />
                </div>
                <div class="input-group full-width">
                  <label for="editAddress">Adresa *</label>
                  <input
                    type="text"
                    id="editAddress"
                    required
                  />
                </div>
                <div class="input-group">
                  <label for="editCity">Mƒõsto *</label>
                  <input
                    type="text"
                    id="editCity"
                    required
                  />
                </div>
                <div class="input-group">
                  <label for="editZip">PSƒå *</label>
                  <input
                    type="text"
                    id="editZip"
                    pattern="[0-9]{5}"
                    required
                  />
                </div>
                <div class="input-group">
                  <label for="editIco">IƒåO</label>
                  <input
                    type="text"
                    id="editIco"
                  />
                </div>
                <div class="input-group">
                  <label for="editDic">DIƒå</label>
                  <input
                    type="text"
                    id="editDic"
                  />
                </div>
                <div class="input-group full-width">
                  <label
                    for="editNotes"
                    data-translate="notes"
                  >
                    Pozn√°mky
                  </label>
                  <textarea
                    id="editNotes"
                    rows="3"
                  ></textarea>
                </div>
                <div class="input-group full-width">
                  <label style="display: flex; align-items: center; gap: 0.5rem">
                    <input
                      type="checkbox"
                      id="editPayFromBenefit"
                      style="width: auto; margin: 0"
                    />
                    <span>Platba z benefit≈Ø</span>
                  </label>
                </div>

                <!-- Guest Names Section -->
                <div
                  id="editGuestNamesSection"
                  class="input-group full-width"
                  style="
                    display: none;
                    margin-top: 1.5rem;
                    padding: 1.5rem;
                    background: #f0fdf4;
                    border: 2px solid #10b981;
                    border-radius: 8px;
                  "
                >
                  <h3 style="margin: 0 0 1rem 0; color: #047857">üë• Jm√©na ubytovan√Ωch osob</h3>

                  <!-- Adults Names -->
                  <div
                    id="editAdultsNamesContainer"
                    style="margin-bottom: 1.5rem"
                  >
                    <h4 style="margin: 0 0 0.75rem 0; color: #059669">Dospƒõl√≠ (18+ let)</h4>
                    <div id="editAdultsNamesList"></div>
                  </div>

                  <!-- Children Names -->
                  <div
                    id="editChildrenNamesContainer"
                    style="display: none"
                  >
                    <h4 style="margin: 0 0 0.75rem 0; color: #059669">Dƒõti (3-17 let)</h4>
                    <div id="editChildrenNamesList"></div>
                  </div>
                </div>
              </div>
            </div>

            <div
              class="modal-actions"
              style="margin-top: 2rem; text-align: right"
            >
              <button
                type="button"
                class="btn btn-secondary"
                onclick="window.location.href='/'"
              >
                Zru≈°it
              </button>
              <button
                type="submit"
                class="btn btn-primary"
                id="editSubmitButton"
              >
                Ulo≈æit zmƒõny
              </button>
              <button
                type="button"
                class="btn btn-danger"
                id="deleteBookingButton"
                onclick="editPage.deleteBooking()"
                style="margin-left: 1rem"
              >
                Smazat rezervaci
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Success Message -->
      <div
        id="successMessage"
        class="success-message"
        style="display: none"
      ></div>
    </div>

    <!-- Shared utilities (MUST load before data.js) -->
    <script src="js/shared/idGenerator.js"></script>
    <script src="js/shared/dateUtils.js"></script>
    <script src="js/shared/validationUtils.js"></script>
    <script src="js/shared/christmasUtils.js"></script>
    <script src="js/shared/priceCalculator.js"></script>
    <script src="js/shared/bookingLogic.js"></script>
    <script src="js/shared/bookingUtils.js"></script>
    <script src="js/calendar-utils.js"></script>
    <script src="js/shared/BaseCalendar.js"></script>
    <script src="js/shared/EditBookingComponent.js"></script>
    <script src="data.js"></script>
    <script src="js/edit-page.js"></script>

    <style>
      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      .spinner {
        border: 4px solid #f3f4f6;
        border-top: 4px solid #0d9488;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes highlightPulse {
        0%,
        100% {
          box-shadow: 0 0 0 0 rgba(239, 68, 68, 0);
        }
        50% {
          box-shadow: 0 0 20px 10px rgba(239, 68, 68, 0.5);
        }
      }

      .form-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }

      .form-grid .full-width {
        grid-column: 1 / -1;
      }

      .input-group {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .input-group label {
        font-weight: 600;
        color: var(--gray-700);
      }

      .input-group input,
      .input-group textarea {
        padding: 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 8px;
        font-size: 1rem;
      }

      .input-group input:focus,
      .input-group textarea:focus {
        outline: none;
        border-color: #0d9488;
        box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
      }

      .modal-actions {
        display: flex;
        gap: 1rem;
        justify-content: flex-end;
        padding-top: 1.5rem;
        border-top: 1px solid #e5e7eb;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn-primary {
        background: #0d9488;
        color: white;
      }

      .btn-primary:hover {
        background: #0f766e;
      }

      .btn-secondary {
        background: #e5e7eb;
        color: #374151;
      }

      .btn-secondary:hover {
        background: #d1d5db;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .success-message {
        position: fixed;
        top: 2rem;
        right: 2rem;
        background: #10b981;
        color: white;
        padding: 1rem 2rem;
        border-radius: 8px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 10000;
      }

      /* Ensure notification container is visible */
      #notificationContainer {
        position: fixed;
        bottom: 20px;
        left: 20px;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        gap: 12px;
        pointer-events: none;
      }

      #notificationContainer .notification {
        pointer-events: all;
      }
    </style>
  </body>
</html>
